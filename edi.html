<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imported Blocks Editor</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #181818;
    color: #e0e0e0;
    margin: 0;
    padding: 0;
}

.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    padding: 20px;
}

textarea {
    width: 80%;
    margin-bottom: 10px;
    padding: 10px;
    background-color: #282828;
    color: #e0e0e0;
    border: 1px solid #444;
    border-radius: 5px;
}

button {
    background-color: #383838;
    color: #e0e0e0;
    border: none;
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #484848;
}

.block-selection, .workspace, .code-pane {
    width: 80%;
    background-color: #282828;
    padding: 20px;
    margin-top: 10px;
    overflow-y: auto;
    border-radius: 5px;
}

.block {
    background-color: #383838;
    color: #e0e0e0;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 5px 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.block:hover {
    background-color: #484848;
}

.editable-content {
    background-color: #181818;
    padding: 2px 5px;
    border-radius: 3px;
    display: inline-block;
}

.drop-area {
    width: 50px;
    height: 30px;
    background-color: #181818;
    display: inline-block;
    margin: 0 5px;
    border: 2px dashed #444;
    border-radius: 5px;
    vertical-align: middle;
}

.code-pane {
    margin-top: 20px;
    padding: 10px;
    height: 200px;
    overflow-y: auto;
    border: 1px solid #444;
    border-radius: 5px;
}

    </style>
</head>

<body>
    <div class="container">
        <textarea id="importArea" rows="10" placeholder="Paste your exported JSON here..."></textarea>
        <button onclick="importBlocks()">Import Blocks</button>
        <div class="workspace">
            <div class="block-selection" id="blockSelection"></div>
            <div class="code-pane" id="codePane"></div>
        </div>
    </div>

    <script>
        function importBlocks() {
            const jsonData = document.getElementById('importArea').value;
            const blocks = JSON.parse(jsonData);
            const blockSelection = document.getElementById('blockSelection');
            blockSelection.innerHTML = '';

            blocks.forEach(blockData => {
                const block = document.createElement('div');
                block.className = 'block';
                block.draggable = true;

                blockData.structure.forEach(part => {
                    if (part.type === 'text') {
                        block.appendChild(document.createTextNode(part.content));
                    } else if (part.type === 'editable') {
                        const editable = document.createElement('span');
                        editable.className = 'editable-content';
                        editable.textContent = part.content;
                        editable.contentEditable = true;
                        block.appendChild(editable);
                    } else if (part.type === 'dropArea') {
                        const dropArea = document.createElement('div');
                        dropArea.className = 'drop-area';
                        dropArea.ondrop = handleDrop;
                        dropArea.ondragover = (event) => event.preventDefault();
                        block.appendChild(dropArea);
                    }
                });

                blockSelection.appendChild(block);
            });
        }

        function handleDrop(event) {
            event.preventDefault();
            const blockCode = event.dataTransfer.getData('block-code');
            const block = document.querySelector(`[data-code="${blockCode}"]`).cloneNode(true);
            event.target.appendChild(block);
            updateCodePane();
        }

        function updateCodePane() {
    const codePane = document.getElementById('codePane');
    const blocks = document.querySelectorAll('.block-selection .block');
    
    let code = '';
    
    blocks.forEach(block => {
        let blockCode = block.dataset.code;

        // If the block contains editable content
        block.querySelectorAll('.editable-content').forEach(editable => {
            let placeholder = 'PLACEHOLDER';  // Generic placeholder, adjust if necessary
            blockCode = blockCode.replace(placeholder, editable.textContent.trim());
        });

        // If the block contains a drop area (like if-blocks)
        const dropArea = block.querySelector('.drop-area');
        if (dropArea) {
            let nestedCode = '';
            dropArea.querySelectorAll('.block').forEach(nestedBlock => {
                let nestedBlockCode = nestedBlock.dataset.code;
                nestedBlock.querySelectorAll('.editable-content').forEach(editable => {
                    let placeholder = 'PLACEHOLDER'; // Generic placeholder, adjust if necessary
                    nestedBlockCode = nestedBlockCode.replace(placeholder, editable.textContent.trim());
                });
                nestedCode += `\t${nestedBlockCode}\n`; // Add indentation for nested code
            });
            blockCode = blockCode.replace('//NESTED_CODE', nestedCode); // Replace a NESTED_CODE placeholder in your block's code with the nested code
        }

        code += `${blockCode}\n`;
    });
    
    codePane.textContent = code;
}


        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.block').forEach(block => {
                block.ondragstart = (event) => {
                    event.dataTransfer.setData('block-code', block.dataset.code);
                };
            });
        });
    </script>
</body>

</html>
