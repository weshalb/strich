<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imported Blocks Editor</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #181818;
    color: #e0e0e0;
    margin: 0;
    padding: 0;
}

.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    padding: 20px;
}

textarea {
    width: 80%;
    margin-bottom: 10px;
    padding: 10px;
    background-color: #282828;
    color: #e0e0e0;
    border: 1px solid #444;
    border-radius: 5px;
}

button {
    background-color: #383838;
    color: #e0e0e0;
    border: none;
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #484848;
}

.block-selection, .workspace, .code-pane {
    width: 80%;
    background-color: #282828;
    padding: 20px;
    margin-top: 10px;
    overflow-y: auto;
    border-radius: 5px;
}

.block {
    background-color: #383838;
    color: #e0e0e0;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 5px 10px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.block:hover {
    background-color: #484848;
}

.editable-content {
    background-color: #181818;
    padding: 2px 5px;
    border-radius: 3px;
    display: inline-block;
}

.drop-area {
    width: 50px;
    height: 30px;
    background-color: #181818;
    display: inline-block;
    margin: 0 5px;
    border: 2px dashed #444;
    border-radius: 5px;
    vertical-align: middle;
}

.code-pane {
    margin-top: 20px;
    padding: 10px;
    height: 200px;
    overflow-y: auto;
    border: 1px solid #444;
    border-radius: 5px;
}

    </style>
</head>

<body>
<div class="container">
    <div>
        <textarea id="importedBlocksJson" rows="5" cols="50" placeholder="Paste your block JSON here..."></textarea><br>
        <button onclick="importBlocksFromJson()">Import Blocks</button>
    </div>
    <div class="block-selection" id="importedBlockSelection"></div>
    <div class="workspace">
        <div class="block-area" id="blockArea"></div>
    </div>
    <div class="code-pane" id="codePane"></div>
</div>

<script>
    function importBlocksFromJson() {
        const jsonData = document.getElementById('importedBlocksJson').value;

        try {
            const blocks = JSON.parse(jsonData);
            const blockSelectionArea = document.getElementById('importedBlockSelection');
            blockSelectionArea.innerHTML = ''; // Clear previous blocks

            blocks.forEach(blockData => {
                const block = document.createElement('div');
                block.className = 'block';
                block.dataset.code = blockData.code;

                blockData.structure.forEach(part => {
                    if (part.type === 'text') {
                        block.appendChild(document.createTextNode(part.content));
                    } else if (part.type === 'editable') {
                        const editable = document.createElement('span');
                        editable.className = 'editable-content';
                        editable.textContent = part.content;
                        editable.contentEditable = true;
                        block.appendChild(editable);
                    } else if (part.type === 'dropArea') {
                        const dropArea = document.createElement('div');
                        dropArea.className = 'drop-area';
                        block.appendChild(dropArea);
                    }
                });

                blockSelectionArea.appendChild(block);
            });

            initializeBlockFunctions();

        } catch (e) {
            alert('Error importing blocks: Invalid JSON format.');
        }
    }

    function initializeBlockFunctions() {
        document.querySelectorAll('.block').forEach(block => {
            block.addEventListener('dragstart', handleDragStart);
        });
    }

    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', e.target.dataset.code);
    }

    document.getElementById('blockArea').addEventListener('dragover', e => e.preventDefault());
    document.getElementById('blockArea').addEventListener('drop', handleDrop);

    function handleDrop(e) {
        e.preventDefault();
        const code = e.dataTransfer.getData('text/plain');
        const sourceBlock = document.querySelector(`[data-code="${code}"]`);
        if (!sourceBlock) return;

        const newBlock = sourceBlock.cloneNode(true);
        e.target.appendChild(newBlock);
        updateCodePane();
    }

    function updateCodePane() {
        const codePane = document.getElementById('codePane');
        codePane.innerHTML = '';

        document.querySelectorAll('.block').forEach(block => {
            let code = block.dataset.code;
            block.querySelectorAll('.editable-content').forEach(span => {
                code = code.replace('MESSAGE', `'${span.textContent.trim()}'`);
            });
            codePane.appendChild(document.createTextNode(code + '\n'));
        });
    }
</script>
</body>
</html>
